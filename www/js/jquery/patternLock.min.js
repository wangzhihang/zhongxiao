(function(factory){var global=Function("return this")()||(42,eval)("this");if(typeof define==="function"&&define.amd){define(["jquery"],function($){return(global.PatternLock=factory($,global))})}else{if(typeof module==="object"&&module.exports){module.exports=global.document?factory(require("jquery"),global):function(w){if(!w.document){throw new Error("patternLock requires a window with a document")}return factory(require("jquery")(w),w)}}else{global.PatternLock=factory(global.jQuery,global)}}}(function(f,i,c){var k=i.document;var a=function(){},l={};function b(n){var u=n.holder,q=n.option,v=q.matrix,o=q.margin,s=q.radius,r=['<ul class="patt-wrap" style="padding:'+o+'px">'];for(var p=0,t=v[0]*v[1];p<t;p++){r.push('<li class="patt-circ" style="margin:'+o+"px; width : "+(s*2)+"px; height : "+(s*2)+"px; -webkit-border-radius: "+s+"px; -moz-border-radius: "+s+"px; border-radius: "+s+'px; "><div class="patt-dots"></div></li>')}r.push("</ul>");u.html(r.join("")).css({"width":(v[1]*(s*2+o*2)+o*2)+"px","height":(v[0]*(s*2+o*2)+o*2)+"px"});n.pattCircle=n.holder.find(".patt-circ")}function d(o,n,r,p){var s=n-o,q=p-r;return{length:Math.ceil(Math.sqrt(s*s+q*q)),angle:Math.round((Math.atan2(q,s)*180)/Math.PI)}}var e=function(r,q){r.preventDefault();var p=l[q.token];if(p.disabled){return}if(!p.option.patternVisible){p.holder.addClass("patt-hidden")}var t=r.type=="touchstart"?"touchmove":"mousemove",o=r.type=="touchstart"?"touchend":"mouseup";f(this).on(t+".pattern-move",function(u){h.call(this,u,q)});f(k).one(o,function(){j.call(this,r,q)});var n=p.holder.find(".patt-wrap"),s=n[0].getBoundingClientRect();p.wrapTop=s.top;p.wrapLeft=s.left;q.reset()},h=function(H,z){H.preventDefault();var v=H.clientX||H.originalEvent.touches[0].clientX,u=H.clientY||H.originalEvent.touches[0].clientY,w=l[z.token],B=w.option,A=w.pattCircle,E=w.patternAry,p=w.getIdxFromPoint(v,u),D=p.idx,G=w.mapperFunc(D)||D;if(E.length>0){var K=d(w.lineX1,p.x,w.lineY1,p.y);w.line.css({"width":(K.length+10)+"px","transform":"rotate("+K.angle+"deg)"})}if(D&&((B.allowRepeat&&E[E.length-1]!==G)||E.indexOf(G)===-1)){var r=f(A[D-1]);if(w.lastPosObj){var t=w.lastPosObj,s=t.i,F=t.j,I=p.i-t.i>0?1:-1,n=p.j-t.j>0?1:-1,C=Math.abs(p.i-s),o=Math.abs(p.j-F);while(((C===0&&o>1)||(o===0&&C>1)||(o==C&&o>1))){s=C?s+I:s;F=o?F+n:F;C=Math.abs(p.i-s);o=Math.abs(p.j-F);var J=(F-1)*B.matrix[1]+s,q=w.mapperFunc(J)||J;if(B.allowRepeat||E.indexOf(q)==-1){w.addDirectionClass({i:s,j:F});w.markPoint(f(A[q-1]),q);w.addLine({i:s,j:F})}}}if(w.lastPosObj){w.addDirectionClass(p)}w.markPoint(r,G);w.addLine(p);w.lastPosObj=p}},j=function(r,q){r.preventDefault();var p=l[q.token],n=p.option,o=p.patternAry.join(n.delimiter);p.holder.off(".pattern-move").removeClass("patt-hidden");if(!o){return}n.onDraw(o);p.line.remove();if(p.rightPattern){if(o==p.rightPattern){p.onSuccess()}else{p.onError();q.error()}}};function m(){}m.prototype={constructor:m,getIdxFromPoint:function(v,t){var r=this.option,u=r.matrix,s=v-this.wrapLeft,o=t-this.wrapTop,w=null,n=r.margin,B=r.radius*2+n*2,A=Math.ceil(s/B),z=Math.ceil(o/B),q=s%B,p=o%B;if(A<=u[1]&&z<=u[0]&&q>n*2&&p>n*2){w=(z-1)*u[1]+A}return{idx:w,i:A,j:z,x:s,y:o}},markPoint:function(o,n){o.addClass("hovered");this.patternAry.push(n);this.lastElm=o},addLine:function(o){var r=this,u=r.patternAry,q=r.option;var x=q.lineOnMove,p=q.margin,s=q.radius,n=(o.i-1)*(2*p+2*s)+2*p+s,w=(o.j-1)*(2*p+2*s)+2*p+s;if(u.length>1){var t=d(r.lineX1,n,r.lineY1,w);r.line.css({"width":(t.length+10)+"px","transform":"rotate("+t.angle+"deg)"});if(!x){r.line.show()}}var v=f('<div class="patt-lines" style="top:'+(w-5)+"px; left:"+(n-5)+'px"></div>');r.line=v;r.lineX1=n;r.lineY1=w;r.holder.append(v);if(!x){r.line.hide()}},addDirectionClass:function(p){var n=this.lastElm,o=this.line,q=this.lastPosObj;var r=[];p.j-q.j>0?r.push("s"):p.j-q.j<0?r.push("n"):0;p.i-q.i>0?r.push("e"):p.i-q.i<0?r.push("w"):0;r=r.join("-");if(r){n.add(o).addClass(r+" dir")}}};function g(q,r){var v=this,p=v.token=Math.random(),o=l[p]=new m(),t=o.holder=f(q);if(t.length===0){return}o.object=v;r=r||{};var s={onDraw:a};var u=r.matrix;if(u&&u[0]*u[1]>9){s.delimiter=","}r=o.option=f.extend({},g.defaults,s,r);b(o);t.addClass("patt-holder");if(t.css("position")=="static"){t.css("position","relative")}t.on("touchstart mousedown",function(w){e.call(this,w,v)});var n=r.mapper;if(typeof n=="object"){o.mapperFunc=function(w){return n[w]}}else{if(typeof n=="function"){o.mapperFunc=n}else{o.mapperFunc=a}}o.option.mapper=null}g.prototype={constructor:g,option:function(n,q){var p=l[this.token],o=p.option;if(q===c){return o[n]}else{o[n]=q;if(n=="margin"||n=="matrix"||n=="radius"){b(p)}}},getPattern:function(){var n=l[this.token];return(n.patternAry||[]).join(n.option.delimiter)},setPattern:function(u){var o=l[this.token],s=o.option,z=s.matrix,q=s.margin,t=s.radius;if(!s.enableSetPattern){return}if(typeof u==="string"){u=u.split(s.delimiter)}this.reset();o.wrapLeft=0;o.wrapTop=0;for(var r=0;r<u.length;r++){var A=u[r]-1,w=A%z[1],v=Math.floor(A/z[1]),p=w*(2*q+2*t)+2*q+t,n=v*(2*q+2*t)+2*q+t;
h.call(null,{clientX:p,clientY:n,preventDefault:a},this)}},enable:function(){var n=l[this.token];n.disabled=false},disable:function(){var n=l[this.token];n.disabled=true},reset:function(){var n=l[this.token];n.pattCircle.removeClass("hovered dir s n w e s-w s-e n-w n-e");n.holder.find(".patt-lines").remove();n.patternAry=[];n.lastPosObj=null;n.holder.removeClass("patt-error")},error:function(){l[this.token].holder.addClass("patt-error")},checkForPattern:function(o,q,n){var p=l[this.token];p.rightPattern=o;p.onSuccess=q||a;p.onError=n||a}};g.defaults={matrix:[3,3],margin:Number(f(i).width()/15)-2,radius:Number(f(i).width()/15)+5,patternVisible:true,lineOnMove:true,delimiter:"",enableSetPattern:false,allowRepeat:false};return g}));
